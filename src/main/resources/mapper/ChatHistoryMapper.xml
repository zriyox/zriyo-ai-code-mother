<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zriyo.aicodemother.mapper.ChatHistoryMapper">


    <select id="ChatHistoryQueryList" resultType="com.zriyo.aicodemother.model.vo.ChatHistoryQueryVo">
        SELECT id, message, messageType, createTime
        FROM chat_history
        WHERE appId = #{request.appId}
        AND userId = #{userId}
        AND messageType IN ('user', 'ai', 'tool') AND user_visible = 1

        <!-- 向上翻页：加载比 cursorId 更早（ID 更小）的消息 -->
        <if test="request.id != null">
            AND id &lt; #{request.id}
        </if>

        ORDER BY id DESC   <!-- 最新消息排在前面 -->
        LIMIT 15
    </select>
</mapper>
